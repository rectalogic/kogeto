<!doctype html>
<html lang="en">
  <head>
    <title>Kogeto Dot Cylindrical Player</title>
  </head>
  <body>
    <script src="Three.js"></script>

    <!-- http://www.kogeto.com/dotspots/RBG9212DOK5Y -->
    <video id="video" autoplay loop cross-origin="" style="display:none">
      <!--http://cdn1.kogeto.com/1321979663e4da1.mp4-->
      <source src="1321979663e4da1.mp4" type='video/mp4; codecs="avc1.42  E01E, mp4a.40.2"'>
    </video>

<script>
function DotPlayer() {
    this.width = 700;
    this.height = 313;
    var horizontalFOVDeg = 100;
    this.horizontalFOVRad = horizontalFOVDeg * Math.PI / 180;
    var verticalFOVDeg = 2 * Math.atan(Math.tan((this.horizontalFOVRad) / 2) / (this.width / this.height)) * 180 / Math.PI;

    this.camera = new THREE.PerspectiveCamera(verticalFOVDeg, this.width / this.height, 1, 5);

    this.scene = new THREE.Scene();
    this.scene.add(this.camera);

    this.video = document.getElementById('video');
    this.texture = new THREE.Texture(this.video);
    this.texture.minFilter = THREE.LinearFilter;
    this.texture.magFilter = THREE.LinearFilter;

    var cylinder = new THREE.CylinderGeometry(1.863, 1.863, 2, 32, 1, true);
    var material = new THREE.MeshBasicMaterial({ map: this.texture });
    var mesh = new THREE.Mesh(cylinder, material);
    mesh.scale.x = -1;
    this.scene.add(mesh);

    this.renderer = new THREE.WebGLRenderer();
    this.renderer.setSize(this.width, this.height);

    document.body.appendChild(this.renderer.domElement);
}

DotPlayer.prototype.pan = function (pixels) {
    this.camera.rotation.y += (pixels / this.width) * this.horizontalFOVRad;
}

DotPlayer.prototype.render = function () {
    if (this.video.readyState === this.video.HAVE_ENOUGH_DATA)
        this.texture.needsUpdate = true;
    this.renderer.render(this.scene, this.camera);
}

var dotplayer = new DotPlayer();

document.addEventListener('mousedown', onDocumentMouseDown, false);
document.addEventListener('mousemove', onDocumentMouseMove, false);
document.addEventListener('mouseup', onDocumentMouseUp, false);

var panStartX = null;

function onDocumentMouseDown(event) {
    event.preventDefault();
    panStartX = event.clientX;
}

function onDocumentMouseMove(event) {
    if (panStartX)
        dotplayer.pan(event.clientX - panStartX);
}

function onDocumentMouseUp(event) {
    panStartX = null;
}

function play() {
    requestAnimationFrame(play);
    dotplayer.render();
}

play();

</script>
  </body>
</html>
